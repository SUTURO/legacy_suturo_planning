(in-package :suturo-planning-planlib)

(defun get-location-to-face ()
  `(,(make-designator 'location '((coords (1 1 1))
                                  (frame "/base_link")))
    ,(make-designator 'location '((coords (1 -1 1))
                                  (frame "/base_link")))
    ,(make-designator 'location '((coords (1 0 1))
                                  (frame "/base_link")))))

(def-goal (perceive (?obj))
  (let* ((objs nil)
         (loc (desig-prop-value ?obj 'at))
         (name (desig-prop-value loc 'name))
         (edible (desig-prop-value ?obj 'edible)))
    (achieve '(home-pose))
    (achieve `(robot-at ,loc))
    ;(loop for loc-to-face in (get-location-to-face)
    ;      do (achieve `(face-loc ,loc-to-face))
    (perform (make-designator 'action 
                              `((to update-objects-on) 
                                (name ,name))));)
    (setf objs (perform (make-designator 'action 
                                         `((to get-objects-with-properties) 
                                           (obj ,?obj)
                                           (props (on))))))
    (setf objs (remove-if (lambda (desig) 
                            (not (eql (desig-prop-value desig 'edible) 
                                      edible)))
                          objs))
    objs))
